import:
  - source: Alfresco/alfresco-build-tools:.travis.common.yml@v1.0.0
os: linux
dist: focal
language: java
jdk:
  - openjdk11
cache:
  directories:
    - $HOME/.m2/repository
jobs:
  include:
    - name: build application
      stage: build
      script: travis_wait $TRAVIS_WAIT_TIMEOUT mvn $MAVEN_CLI_OPTS verify -Dlogging.root.level=off -Dspring.main.banner-mode=off
    - name: publish artifacts
      stage: publish
      script: travis_wait $TRAVIS_WAIT_TIMEOUT mvn $MAVEN_CLI_OPTS deploy -DskipTests
before_install:
  - |-
    if [[ "$TRAVIS_JDK_VERSION" == "openjdk11" ]]
    then
      echo "use latest OS provided openjdk11"
      export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
      export PATH=$JAVA_HOME/bin:$PATH
    else
      echo "use Travis provided jdk"
    fi
    which java
    java --version
  - |-
    mkdir -p $HOME/.m2
    cp settings.xml $HOME/.m2
    export MAVEN_CLI_OPTS="$MAVEN_CLI_OPTS -B -q -e -fae -V -DinstallAtEnd=true -DdeployAtEnd=true -U"


import:
  - source: Alfresco/alfresco-build-tools:.travis.common.yml@v1.0.0
  - source: Alfresco/alfresco-build-tools:.travis.maven_config.yml@OPSEXP-715
dist: focal
language: java
jdk:
  - openjdk11
install: travis_wait $TRAVIS_WAIT_TIMEOUT mvn $MAVEN_CLI_OPTS dependency:resolve dependency:resolve-plugins || true
_shared_build_application_job: &shared_job
  stage: build
  script: travis_wait ${TRAVIS_WAIT_TIMEOUT} mvn ${MAVEN_CLI_OPTS} clean install -Dlogging.root.level=off -Dspring.main.banner-mode=off

jobs:
  include:
    - name: build application on openjdk8
      jdk: openjdk8
      <<: *shared_job
      if: env(BUILD_JAVA8) = true
    - name: build application
      <<: *shared_job
    - name: publish artifacts
      stage: publish
      script: travis_wait $TRAVIS_WAIT_TIMEOUT mvn $MAVEN_CLI_OPTS source:jar javadoc:jar deploy -DskipTests
before_install:
  - |-
    export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
    export PATH=$JAVA_HOME/bin:$PATH
    java -version
    mvn --version
    export MAVEN_CLI_OPTS="$MAVEN_CLI_OPTS --batch-mode --quiet --errors --fail-at-end --show-version -DinstallAtEnd=true -DdeployAtEnd=true -U"
    env


name: Create Dependency Graph
description: Create dependency graph for the project

inputs:
  restore-artifact-pattern:
    description: Pattern to match artifacts.
    required: false
  restore-artifact-path:
    description: Path to the artifact directory.
    required: false
  java-version:
    description: Java version to use.
    required: true
  maven-version:
    description: Maven version to use.
    required: true
  maven-args:
    description: Maven arguments for dependency submission.
    required: true
  maven-username:
    description: Maven username for authentication.
    required: false
  maven-password:
    description: Maven password for authentication.
    required: false
  ghcr-username:
    description: ghcr.io user name
    required: false
  ghcr-password:
    description: ghcr.io password
    required: false

runs:
  using: composite
  steps:
    - name: Download M2 build artifacts
      if: ${{ inputs.restore-artifact-pattern != '' }}
      uses: actions/download-artifact@95815c38cf2ff2164869cbab79da8d1f422bc89e # v4.2.1
      with:
        pattern: ${{ inputs.restore-artifact-pattern }}
        merge-multiple: true
        path: ${{ inputs.restore-artifact-path }}

    - uses: Alfresco/alfresco-build-tools/.github/actions/maven-configure@v8.24.0
      id: maven-configure
      with:
        java-version: ${{ inputs.java-version }}
        maven-version: ${{ inputs.maven-version }}

    - name: Submit Dependency Graph
      uses: advanced-security/maven-dependency-submission-action@4f64ddab9d742a4806eeb588d238e4c311a8397d # v4.1.1
      with:
        maven-args: ${{steps.maven-configure.outputs.maven-options}} ${{ inputs.maven-args }}
      env:
        MAVEN_USERNAME: ${{ inputs.maven-username }}
        MAVEN_PASSWORD: ${{ inputs.maven-password }}
        GHCR_USERNAME: ${{ inputs.ghcr-username }}
        GHCR_PASSWORD: ${{ inputs.ghcr-password }}

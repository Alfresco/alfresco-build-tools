name: "maven-deploy-file"
description: "Deploy one or more binaries to a maven repository"
inputs:
  group-id:
    description: The python version of the local runner
    required: true
  artifact-id:
    description: The python version of the local runner
    required: true
  repository-url:
    description: The python version of the local runner
    required: true
  version:
    description: The version of the artifact(s)
    required: true
  file:
    description: Path to the main file that needs to be deployed
    required: true
  maven-username:
    description: Username to authenticate to the maven repository (when not using a custom settings.xml)
    required: false
  maven-password:
    description: Password to authenticate to the maven repository (when not using a custom settings.xml)
    required: false
  repository-id:
    description: Credentials to use that are defined in settings.xml
    required: false
    default: authenticated-maven-repository
  classifier:
    description: Classifier of the main file that needs to be deployed
    required: false
  files:
    description: Comma separated paths to additional files that needs to be deployed
    required: false
  classifiers:
    description: Comma separated classifiers for additional files that needs to be deployed
    required: false
runs:
  using: "composite"
  steps:
    - name: Stub settings.xml if not already existing
      shell: bash
      run: |
        if [ ! -f ~/.m2/settings.xml ]; then
          echo "Using default settings.xml, make sure to provide credentials as maven-username and maven-password inputs"
          mkdir -p ~/.m2/
          cp ${{ github.action_path }}/settings.xml ~/.m2/
        else
          echo "Existing settings.xml found, make sure to specify the correct repository-id for auth to work"
        fi
    - shell: bash
      env:
        MAVEN_USERNAME: ${{ inputs.maven-username }}
        MAVEN_PASSWORD: ${{ inputs.maven-password }}
      run: |
        mvn deploy:deploy-file -B \
          -DgroupId=${{ inputs.group-id }} \
          -DartifactId=${{ inputs.artifact-id }} \
          -Durl=${{ inputs.repository-url }} \
          -DrepositoryId=${{ inputs.repository-id }} \
          -Dversion=${{ inputs.version }} \
          -Dfile=${{ inputs.file }} \
          -Dclassifier=${{ inputs.classifier }} \
          -Dfiles=${{ inputs.files }} \
          -Dclassifiers=${{ inputs.classifiers }}

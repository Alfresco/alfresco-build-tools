name: CI

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      - name: pre-commit checks
        uses: ./.github/actions/pre-commit
      - name: Ensure SHA pinned actions
        uses: zgosalvez/github-actions-ensure-sha-pinned-actions@c3a2b64f69b7a1542a68f44d9edbd9ec3fc1455e # v3.0.20
        with:
          allowlist: |
            Alfresco/alfresco-build-tools/
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      # - name: Manual test for send slack notification
      #   uses: ./.github/actions/send-slack-notification
      #   with:
      #     channel-id: '' # grab your slack id from your profile -> three dots -> Copy member ID
      #     token: ${{ secrets.SLACK_BOT_TOKEN }}
      #     notification-color: '#A30200'
      #     append: true
      #     message: |
      #       This is a multiline message with `code`
      #
      #       * another line
      #       * one more

      #region Test setup-helm-docs

      - uses: ./.github/actions/dispatch-resume-workflow
        id: dispatch-resume-workflow
        with:
          repo: Alfresco/alfresco-build-tools
          run-id: 12833243779
          ref: fix/AAE-30060-fix-rerun-on-success
          workflow: release.yml
          token: ${{ secrets.BOT_GITHUB_TOKEN }}
          wait-for-completion: true
          wait-for-completion-interval: 5s

name: CI

# Controls when the action will run.
on:
  # Triggers the workflow on push or pull request events but only for the develop branch
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:

  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - uses: ./.github/actions/pre-commit
      - uses: ./.github/actions/setup-helm
      - uses: ./.github/actions/setup-helm-docs
      - uses: ./.github/actions/setup-jx-release-version
      - uses: ./.github/actions/setup-kubepug
      - uses: ./.github/actions/setup-rancher-cli
        with:
          url: ${{ secrets.RANCHER2_URL }}
          access-key: ${{ secrets.RANCHER2_ACCESS_KEY }}
          secret-key: ${{ secrets.RANCHER2_SECRET_KEY }}
          context: local
      - uses: ./.github/actions/setup-updatebot
      - uses: ./.github/actions/setup-yq
      - uses: ./.github/actions/setup-pysemver
      - uses: ./.github/actions/calculate-next-internal-version
        with:
          next-version: 7.3.0
      - uses: ./.github/actions/setup-checkov
      - uses: ./.github/actions/configure-git-user
        with:
          username: ${{  secrets.BOT_GITHUB_USERNAME }}
      - uses: ./.github/actions/resolve-preview-name
      - uses: ./.github/actions/run-pre-commit-for-helm
